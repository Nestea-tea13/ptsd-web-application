<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Questionnaires</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>

    <header th:insert="blocks/headers :: header-user-page"></header>

    <div class="container mt-5">
        <h1 class="text-center"> Ваши результаты опросов </h1><br>

        <div class="p-3 mb-2 bg-light text-dark">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8 text-center" data-toggle="collapse" href="#collapseCAPS" role="button" aria-expanded="false" aria-controls="collapseCAPS">
                    <span data-toggle="tooltip" data-placement="bottom" title="Нажмите, чтобы открыть/закрыть результаты данного вида опросника">
                        <strong>Шкала для клинической диагностики ПТСР (Clinical-administered PTSD Scale - CAPS)</strong>
                    </span>                
                </div>
                <div class="col-md-2"></div>
            </div>
        </div>

        <div class="collapse" id="collapseCAPS">
            <div class="card card-body">

                <div th:if="${CAPSResults}"> 
                    <div class="header-info-rightbox">
                        <canvas id="CAPSResultsChart"></canvas>
                    </div><br>

                    <table class="table table-bordered table-hover">
                        <thead>
                            <th th:each="h : ${headers[0]}" th:text="${h}"/>
                        </thead>
                        <tbody>
                            <tr th:each="r, iter : ${CAPSResults}">
                                <td th:text="${iter.index}+1"></td>
                                <td th:text="${r.date}"></td>
                                <td th:text="${r.resultFrequency}"></td>
                                <td th:text="${r.resultIntensity}"></td>
                                <td>К ответам</td>
                                <td><a th:href="@{/questionnaires/{name}/{id}(name='CAPS',id=${r.id})}">К ответам</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div th:unless="${CAPSResults}">
                    <p class="text-center"> Нет пройденных опросов </p>
                </div>

            </div>
        </div><br>


        <div class="p-3 mb-2 bg-light text-dark">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8 text-center" data-toggle="collapse" href="#collapseIESR" role="button" aria-expanded="false" aria-controls="collapseIESR">
                    <span data-toggle="tooltip" data-placement="bottom" title="Нажмите, чтобы открыть/закрыть результаты данного вида опросника">
                        <strong>Шкала оценки влияния травматического события (Impact of Event Scale-R - IES-R)</strong>
                    </span>                
                </div>
                <div class="col-md-2"></div>
            </div>
        </div>

        <div class="collapse" id="collapseIESR">
            <div class="card card-body">
                
                <div th:if="${IESRResults}"> 
                    <div class="header-info-rightbox">
                        <canvas id="IESRResultsChart"></canvas>
                    </div><br>

                    <table class="table table-bordered table-hover">
                        <thead>
                            <th th:each="h : ${headers[1]}" th:text="${h}"/>
                        </thead>
                        <tbody>
                            <tr th:each="r, iter : ${IESRResults}">
                                <td th:text="${iter.index}+1"></td>
                                <td th:text="${r.date}"></td>
                                <td th:text="${r.resultIN}"></td>
                                <td th:text="${r.resultAV}"></td>
                                <td th:text="${r.resultAR}"></td>
                                <td>К ответам</td>
                                <td><a th:href="@{/questionnaires/{name}/{id}(name='IESR',id=${r.id})}">К ответам</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div th:unless="${IESRResults}">
                    <p class="text-center"> Нет пройденных опросов </p>
                </div>

            </div>
        </div><br>


        <div class="p-3 mb-2 bg-light text-dark">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8 text-center" data-toggle="collapse" href="#collapseBHS" role="button" aria-expanded="false" aria-controls="collapseBHS">
                    <span data-toggle="tooltip" data-placement="bottom" title="Нажмите, чтобы открыть/закрыть результаты данного вида опросника">
                        <strong>Шкала Безнадежности Бека (Beck Hopelessness Scale, BHS)</strong>
                    </span>                
                </div>
                <div class="col-md-2"></div>
            </div>
        </div>

        <div class="collapse" id="collapseBHS">
            <div class="card card-body">
                
                <div th:if="${BHSResults}"> 
                    <div class="header-info-rightbox">
                        <canvas id="BHSResultsChart"></canvas>
                    </div><br>

                    <table class="table table-bordered table-hover">
                        <thead>
                            <th th:each="h : ${headers[2]}" th:text="${h}"/>
                        </thead>
                        <tbody>
                            <tr th:each="r, iter : ${BHSResults}">
                                <td th:text="${iter.index}+1"></td>
                                <td th:text="${r.date}"></td>
                                <td th:text="${r.result}"></td>
                                <td>К ответам</td>
                                <td><a th:href="@{/questionnaires/{name}/{id}(name='BHS',id=${r.id})}">К ответам</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div th:unless="${BHSResults}">
                    <p class="text-center"> Нет пройденных опросов </p>
                </div>
                
            </div>
        </div><br>


        <div class="p-3 mb-2 bg-light text-dark">
            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-10 text-center" data-toggle="collapse" href="#collapseTOP8" role="button" aria-expanded="false" aria-controls="collapseTOP8">
                    <span data-toggle="tooltip" data-placement="bottom" title="Нажмите, чтобы открыть/закрыть результаты данного вида опросника">
                        <strong>Опросник для оценки терапевтической динамики ПТСР «Treatment Outcome PTSD Scale» (TOP-8)</strong>
                    </span>                
                </div>
                <div class="col-md-1"></div>
            </div>
        </div>

        <div class="collapse" id="collapseTOP8">
            <div class="card card-body">
                
                <div th:if="${TOP8Results}">
                    <div class="header-info-rightbox">
                        <canvas id="TOP8ResultsChart"></canvas>
                    </div><br>

                    <table class="table table-bordered table-hover">
                        <thead>
                            <th th:each="h : ${headers[3]}" th:text="${h}"/>
                        </thead>
                        <tbody>
                            <tr th:each="r, iter : ${TOP8Results}">
                                <td th:text="${iter.index}+1"></td>
                                <td th:text="${r.date}"></td>
                                <td th:text="${r.result}"></td>
                                <td><a th:href="@{/questionnaires/{name}/{id}(name='TOP8',id=${r.id})}">К ответам</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div th:unless="${TOP8Results}">
                    <p class="text-center"> Нет пройденных опросов </p>
                </div>
                
            </div>
        </div><br>
    </div>
   
    <div th:insert="blocks/footer :: footer"></div>

    <script>
        $('[data-toggle="tooltip"]').tooltip()
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script> 

    <script th:inline="javascript">
        var ctxCAPS = document.querySelector('#CAPSResultsChart').getContext('2d');

        /*<![CDATA[*/ var xLabelsCAPS = /*[[ ${ChartLabelsCAPS} ]]*/ 'labels' /*]]*/;
        /*<![CDATA[*/ var yDataCAPS = /*[[ ${ChartDateCAPS} ]]*/ 'data' /*]]*/;

        var CAPSResultsChart = new Chart(ctxCAPS, {
            type: 'line',
            data: {
                labels: xLabelsCAPS,
                datasets: [
                    {
                        label: 'Частота',
                        data: yDataCAPS[0],
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    },
                    {
                        label: 'Интенсивность',
                        data: yDataCAPS[1],
                        fill: false,
                        borderColor: 'rgb(204, 153, 255)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        min: 0,
                        max: 68,
                    }
                }
            }
        });
    </script>

    <script th:inline="javascript">
        var ctxIESR = document.querySelector('#IESRResultsChart').getContext('2d');

        /*<![CDATA[*/ var xLabelsIESR = /*[[ ${ChartLabelsIESR} ]]*/ 'labels' /*]]*/;
        /*<![CDATA[*/ var yDataIESR = /*[[ ${ChartDateIESR} ]]*/ 'data' /*]]*/;

        var IESRResultsChart = new Chart(ctxIESR, {
            type: 'line',
            data: {
                labels: xLabelsIESR,
                datasets: [
                    {
                        label: 'Шкала «вторжение» (IN)',
                        data: yDataIESR[0],
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    },
                    {
                        label: 'Шкала «избегание» (AV)',
                        data: yDataIESR[1],
                        fill: false,
                        borderColor: 'rgb(204, 153, 255)',
                        tension: 0.1
                    },
                    {
                        label: 'Шкала возбуждение» (AR)',
                        data: yDataIESR[2],
                        fill: false,
                        borderColor: 'rgb(153, 255, 153)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        min: 0,
                        max: 40,
                    }
                }
            }
        });
    </script>

    <script th:inline="javascript">
        var ctxBHS = document.querySelector('#BHSResultsChart').getContext('2d');

        /*<![CDATA[*/ var xLabelsBHS = /*[[ ${ChartLabelsBHS} ]]*/ 'labels' /*]]*/;
        /*<![CDATA[*/ var yDataBHS = /*[[ ${ChartDateBHS} ]]*/ 'data' /*]]*/;

        var BHSResultsChart = new Chart(ctxBHS, {
            type: 'line',
            data: {
                labels: xLabelsBHS,
                datasets: [{
                    label: 'Результаты',
                    data: yDataBHS,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    y: {
                        min: 0,
                        max: 20,
                    }
                }
            }
        });
    </script>

    <script th:inline="javascript">
        var ctxTOP8 = document.querySelector('#TOP8ResultsChart').getContext('2d');

        /*<![CDATA[*/ var xLabelsTOP8 = /*[[ ${ChartLabelsTOP8} ]]*/ 'labels' /*]]*/;
        /*<![CDATA[*/ var yDataTOP8 = /*[[ ${ChartDateTOP8} ]]*/ 'data' /*]]*/;

        let TOP8ResultsChart = new Chart(ctxTOP8, {
            type: 'line',
            data: {
                labels: xLabelsTOP8,
                datasets: [{
                    label: 'Результаты', 
                    data: yDataTOP8,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    y: {
                        min: 0,
                        max: 32,
                        ticks: {
                            stepSize: 4
                        }
                    }
                }
            }
        });
    </script>
    
</body>

<style>

    .tooltip-inner {
        background-color: #000000;
        max-width: 40rem;
    }
  
</style>

</html>